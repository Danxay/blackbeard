(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[237],{6812:(e,s,t)=>{Promise.resolve().then(t.bind(t,9204))},9204:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>f});var r=t(5155),a=t(6286),l=t(1466),i=t(9842),c=t(2423),d=t(6889),n=t(7223),o=t(9053),x=t(4505),m=t(7396),u=t(3528),h=t(1562),p=t(6046),b=t(2115);async function j(e){var s,t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=(null===(t=window.Telegram)||void 0===t?void 0:null===(s=t.WebApp)||void 0===s?void 0:s.initData)?window.Telegram.WebApp.initData:null,l={"Content-Type":"application/json",...r.headers};a&&(l["X-Init-Data"]=a);let i=await fetch("".concat("http://localhost:8000/api").concat(e),{...r,headers:l});if(!i.ok)throw Error("API Error: ".concat(i.status));return i.json()}let v={createBooking:e=>j("/bookings",{method:"POST",body:JSON.stringify(e)})};var g=t(5552);function f(){let e=(0,p.useRouter)(),{isTelegram:s}=(0,g.j)(),[t,j]=(0,b.useState)(!1),[f,N]=(0,b.useState)(null),{selectedBarber:w,selectedServices:y,selectedDate:S,selectedTime:k,getTotalPrice:T,getTotalDuration:D}=(0,u.m)(),A=T(),B=D();if((0,b.useEffect)(()=>{w&&0!==y.length&&k||e.push("/services")},[]),!w||0===y.length)return null;let _=S?S.toLocaleDateString("ru",{day:"numeric",month:"short",weekday:"short"}):"",C=async()=>{if(S&&k&&w){j(!0),N(null);try{if(s){let e=S.toISOString().split("T")[0];await v.createBooking({barber_id:w.id,service_ids:y.map(e=>e.id),date:e,time:k})}e.push("/success")}catch(e){console.error("Booking error:",e),N("Ошибка при создании записи. Попробуйте ещё раз."),j(!1)}}};return(0,r.jsxs)("main",{className:"min-h-screen bg-bg",children:[(0,r.jsx)(a.A,{title:"Подтверждение"}),(0,r.jsxs)("div",{className:"p-4 pb-44 space-y-4",children:[(0,r.jsxs)("div",{className:"bg-bg-card rounded-2xl border border-border p-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1 text-text-muted text-xs mb-3",children:[(0,r.jsx)(l.A,{className:"w-3 h-3"}),(0,r.jsx)("span",{children:"Мастер"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("img",{src:w.image,alt:w.name,className:"w-12 h-12 rounded-xl object-cover"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-white font-medium",children:w.name}),(0,r.jsx)("p",{className:"text-text-muted text-sm",children:w.role})]})]})]}),(0,r.jsxs)("div",{className:"bg-bg-card rounded-2xl border border-border p-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1 text-text-muted text-xs mb-3",children:[(0,r.jsx)(i.A,{className:"w-3 h-3"}),(0,r.jsx)("span",{children:"Услуги"})]}),(0,r.jsx)("div",{className:"space-y-3",children:y.map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-white text-sm",children:e.name}),(0,r.jsxs)("p",{className:"text-text-muted text-xs",children:[e.duration," мин"]})]}),(0,r.jsxs)("p",{className:"text-white font-medium",children:[e.price," ₽"]})]},e.id))})]}),(0,r.jsx)("div",{className:"bg-bg-card rounded-2xl border border-border p-4",children:(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-1 text-text-muted text-xs mb-2",children:[(0,r.jsx)(c.A,{className:"w-3 h-3"}),(0,r.jsx)("span",{children:"Дата"})]}),(0,r.jsx)("p",{className:"text-white font-medium",children:_})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-1 text-text-muted text-xs mb-2",children:[(0,r.jsx)(d.A,{className:"w-3 h-3"}),(0,r.jsx)("span",{children:"Время"})]}),(0,r.jsx)("p",{className:"text-white font-medium",children:k})]})]})}),(0,r.jsx)(m.default,{href:"/location",className:"block bg-bg-card rounded-2xl border border-border p-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 rounded-xl bg-bg-elevated flex items-center justify-center",children:(0,r.jsx)(n.A,{className:"w-5 h-5 text-text-secondary"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-white font-medium",children:h.DH.name}),(0,r.jsx)("p",{className:"text-text-muted text-sm",children:h.DH.address.short})]})]}),(0,r.jsx)(o.A,{className:"w-4 h-4 text-text-muted"})]})}),f&&(0,r.jsx)("div",{className:"p-3 bg-error/10 border border-error/20 rounded-xl",children:(0,r.jsx)("p",{className:"text-error text-sm text-center",children:f})})]}),(0,r.jsxs)("div",{className:"fixed bottom-0 left-0 right-0 p-4 pb-6 glass border-t border-border",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3 px-1",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-text-muted text-xs",children:"Итого"}),(0,r.jsxs)("p",{className:"text-text-secondary text-sm flex items-center gap-1",children:[(0,r.jsx)(d.A,{className:"w-3.5 h-3.5"}),B," мин"]})]}),(0,r.jsxs)("p",{className:"text-white text-2xl font-semibold",children:[A," ₽"]})]}),(0,r.jsxs)("button",{onClick:C,disabled:t,className:"flex items-center justify-between w-full bg-white text-black py-4 px-6 rounded-2xl font-semibold active:scale-[0.98] transition-transform disabled:opacity-50",children:[(0,r.jsx)("span",{children:t?"Создание записи...":"Подтвердить"}),t?(0,r.jsx)(x.A,{className:"w-5 h-5 animate-spin"}):(0,r.jsx)(o.A,{className:"w-5 h-5"})]}),(0,r.jsx)("p",{className:"text-text-muted text-xs text-center mt-3",children:"Оплата на месте \xb7 Отмена за 2 часа бесплатно"})]})]})}},6286:(e,s,t)=>{"use strict";t.d(s,{A:()=>i});var r=t(5155),a=t(6046),l=t(7364);function i(e){let{title:s,showBack:t=!0}=e,i=(0,a.useRouter)();return(0,r.jsx)("header",{className:"sticky top-0 z-40 glass border-b border-border",children:(0,r.jsxs)("div",{className:"flex items-center justify-between h-14 px-4",children:[t?(0,r.jsx)("button",{onClick:()=>i.back(),className:"flex items-center justify-center w-10 h-10 -ml-2 rounded-full hover:bg-bg-hover text-white transition-colors",children:(0,r.jsx)(l.A,{className:"w-5 h-5"})}):(0,r.jsx)("div",{className:"w-10"}),(0,r.jsx)("h1",{className:"text-base font-semibold text-white tracking-tight",children:s}),(0,r.jsx)("div",{className:"w-10"})]})})}},1562:(e,s,t)=>{"use strict";t.d(s,{DH:()=>r,TF:()=>a,VZ:()=>l,Wk:()=>i});let r={name:"Black Beard",tagline:"Премиум барбершоп",address:{street:"ул. Тверская, 15",city:"Москва",metro:"м. Пушкинская",short:"Тверская 15, Пушкинская",full:"Москва, ул. Тверская, 15 (м. Пушкинская)"},phone:"+7 (495) 123-45-67",phoneClean:"+74951234567",workHours:{weekdays:"10:00 - 22:00",saturday:"10:00 - 21:00",sunday:"11:00 - 20:00"},mapsUrl:"https://yandex.ru/maps/-/CDuOzK~V",mapImage:"https://static-maps.yandex.ru/1.x/?ll=37.606628,55.763969&z=16&l=map&size=450,300&pt=37.606628,55.763969,pm2rdm",schedule:[{day:"Понедельник",hours:"10:00 – 22:00",open:"10:00",close:"22:00",isToday:!1},{day:"Вторник",hours:"10:00 – 22:00",open:"10:00",close:"22:00",isToday:!1},{day:"Среда",hours:"10:00 – 22:00",open:"10:00",close:"22:00",isToday:!1},{day:"Четверг",hours:"10:00 – 22:00",open:"10:00",close:"22:00",isToday:!1},{day:"Пятница",hours:"10:00 – 22:00",open:"10:00",close:"22:00",isToday:!1},{day:"Суббота",hours:"10:00 – 21:00",open:"10:00",close:"21:00",isToday:!1},{day:"Воскресенье",hours:"11:00 – 20:00",open:"11:00",close:"20:00",isToday:!1}],social:{instagram:"@blackbeard_moscow",telegram:"@blackbeard_bot",vk:"vk.com/blackbeard_moscow"}};function a(){let e=new Date().getDay(),s=r.schedule[0===e?6:e-1];return{open:s.open,close:s.close,hours:s.hours}}function l(){let e=new Date,s=a(),[t,r]=s.open.split(":").map(Number),[l,i]=s.close.split(":").map(Number),c=60*e.getHours()+e.getMinutes();return c>=60*t+r&&c<60*l+i}function i(e){let s=new Date;return s.setDate(s.getDate()+e),s}},5552:(e,s,t)=>{"use strict";t.d(s,{j:()=>a});var r=t(2115);function a(){let[e,s]=(0,r.useState)(!1),[t,a]=(0,r.useState)(null),[l,i]=(0,r.useState)(null),[c,d]=(0,r.useState)(null);return(0,r.useEffect)(()=>{var e,t;if(s(!0),null===(e=window.Telegram)||void 0===e?void 0:e.WebApp){let e=window.Telegram.WebApp;e.ready();try{e.expand()}catch(e){console.warn("Failed to expand WebApp:",e)}a(e),i((null===(t=e.initDataUnsafe)||void 0===t?void 0:t.user)||null),d(e.initData||null);try{e.setHeaderColor("#0a0a0a"),e.setBackgroundColor("#0a0a0a")}catch(e){console.warn("Failed to set colors:",e)}}},[]),{tg:t,user:l,initData:c,onClose:()=>{null==t||t.close()},isReady:e&&!!t,isTelegram:e&&!!t,isMounted:e}}},3528:(e,s,t)=>{"use strict";t.d(s,{m:()=>i});var r=t(9827),a=t(709);let l={selectedServices:[],selectedBarber:null,selectedDate:null,selectedTime:null,entryPoint:null},i=(0,r.v)()((0,a.Zr)((e,s)=>({...l,setServices:s=>e({selectedServices:s}),addService:s=>e(e=>({selectedServices:[...e.selectedServices,s]})),removeService:s=>e(e=>({selectedServices:e.selectedServices.filter(e=>e.id!==s)})),toggleService:e=>{s().selectedServices.some(s=>s.id===e.id)?s().removeService(e.id):s().addService(e)},setBarber:s=>e({selectedBarber:s}),setDate:s=>e({selectedDate:s}),setTime:s=>e({selectedTime:s}),setEntryPoint:s=>e({entryPoint:s}),getTotalPrice:()=>s().selectedServices.reduce((e,s)=>e+s.price,0),getTotalDuration:()=>s().selectedServices.reduce((e,s)=>e+s.duration,0),reset:()=>e(l),isServiceSelected:e=>s().selectedServices.some(s=>s.id===e)}),{name:"booking-storage",partialize:e=>({selectedServices:e.selectedServices,selectedBarber:e.selectedBarber})}))}},e=>{var s=s=>e(e.s=s);e.O(0,[908,225,441,517,358],()=>s(6812)),_N_E=e.O()}]);